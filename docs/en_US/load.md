# Load

```console
$ image-tools load -h
Usage of load:
  -compress string
        compress format, can be 'gzip', 'zstd' or 'dir' (default "gzip")
  -d string
        target private registry: port
  -debug
        enable the debug output
  -default-project string
        project name when project is empty (default "library")
  -harbor-https
        use HTTPS by default when create harbor project (default true)
  -j int
        job number, async mode if larger than 1, maximum is 20 (default 1)
  -o string
        file name of the load failed image list (default "load-failed.txt")
  -repo-type string
        repository type, can be 'harbor' or empty
  -s string
        saved file to load (tar tarball or a directory)
```

## Quick Start

Import the tar.gz compressed package exported by the `save` command to `private.registry.io`:

```sh
./image-tools load -s ./saved-images.tar.gz -d private.registry.io
```

This command will automatically create a multi-architecture Manifest list in the target registry based on the image file saved during `save`.

### Harbor V2

If the target image registry is Harbor V2, then you can use the `-repo-type=harbor` parameter, which will automatically create a project for the Harbor V2 registry when importing.

In addition, if the target image in the image list does not contain `Project` during Save (such as `mysql:8.0`, `busybox:latest` of Docker Hub), then `library` will be automatically added to it during the Load process Project prefix (`library/mysql:8.0`, `library/busybox:latest`).

You can use `-default-project=library` parameter to specify the name of the added Project (default is `library`).

## Parameters

Command line parameters:

```sh
# Use the -s (source file) parameter to specify the imported file (required parameter)
./image-tools load -s ./saved-images.tar.gz

# Use the -d (destination) parameter to specify the registry of the target image
# The priority is: -d parameter > DOCKER_REGISTRY environment variable
./image-tools load -s ./saved-images.tar.gz -d private.registry.io

# Use the -compress parameter to specify the compression format of the imported file
# Optional: gzip, zstd, dir
# The default is gzip format, if dir is specified, it means loading the image from the folder without decompressing it
./image-tools load -s ./saved-images.tar.zstd -compress=zstd

# Use -repo-type to specify the type of the target mirror registry, the default is an empty string, and it can be set to "harbor"
# When the type of the target mirror registry is harbor, a project will be automatically created for the target mirror
./image-tools load -s ./saved-images.tar.gz -d private.registry.io -repo-type=harbor

# Use the -default-project parameter to specify the default project name
# The default value is library
# This parameter will rename `private.io/mysql:5.8` to `private.io/library/mysql:5.8`
./image-tools load -s ./saved-images.tar.gz -d private.registry.io -repo-type=harbor -default-project=library

# Use the -j (jobs) parameter to specify the number of goroutine pools and import images concurrently (support 1~20 jobs)
./image-tools load -s ./saved-images.tar.gz -j 10 # Start 10 workers

# Use the -o (output) parameter to output the mirror list that failed to load to the specified file
# Default output to mirror-failed.txt
./image-tools load -s ./saved-images.tar.gz -o failed-list.txt

# Use the -debug parameter to output more detailed debug logs
./image-tools load -s ./saved-images.tar.gz -debug
```

## Load the sub-volume compressed package

The Load subcommand supports loading the sub-volume (part) compressed package generated by save. The file name should be suffixed with `.part*` and arranged in the order of `.part0`, `.part1`, `.part2`.... When loading a sub-volume compressed package, the source file name specified by the `-s` parameter should not contain the `.part*` suffix (such as `saved-images.tar.gz`), the tool will automatically identify the sub-volume compressed package and read and decompress data from `part0`, `part1`... in order.

```console
$ ls -alh
drwxr-xr-x 6 root root 192B 1 6 18:00 .
drwxr-x---+ 70 root root 2.2K 1 6 18:00 ..
-rw-r--r-- 1 root root 50M 1 6 17:59 saved-images.tar.gz.part0
-rw-r--r-- 1 root root 50M 1 6 17:59 saved-images.tar.gz.part1
-rw-r--r-- 1 root root 50M 1 6 17:59 saved-images.tar.gz.part2
-rw-r--r-- 1 root root 5.3M 1 6 17:59 saved-images.tar.gz.part3

$ image-tools load -s saved-images.tar.gz -d private.registry.io
18:01:28 [INFO] Decompressing saved-images.tar.gz...
18:01:28 [INFO] Read "saved-images.tar.gz.part0"
18:01:28 [INFO] Read "saved-images.tar.gz.part1"
18:01:28 [INFO] Read "saved-images.tar.gz.part2"
18:01:28 [INFO] Read "saved-images.tar.gz.part3"
â€¦
```

> Please do not try to load a part file separately, you will encounter an error of decompression failure, and the decompressed file will be damaged.

## Logs

The log output by executing this tool includes "time, log level", `M_ID` (corresponding to the Nth Manifest list imported) and `IMG_ID` (the Nth Manifest list in the Manifest list) of each log line during the concurrent copy can be used to track exactly which image copy failed.

## Output

If a certain image fails to be imported during the copy process, the tool will output the failed image list to `load-failed.txt`, and the `-o` parameter can be used to set the file name of the failed image list.
